!function(d){function t(){var e=[],a=!0;return{isSaveToPop:function(t){if(void 0===t)return a;a=t,this.next()},push:function(t){e.push(t),this.next()},next:function(){var t;!a||"function"==typeof(t=e.shift())&&t()}}}var r,s="data-itemId",i=new t,n=new t;function c(){d("html, body").animate({scrollTop:d(".visualized-tabs-wrapper").offset().top-60},700)}function l(t){var e=d("#tabstrip li["+s+'="'+t+'"]').attr("aria-controls"),a=d("#"+e);a.find(".found-products-grid .loader").show(),(e=addAntiForgeryToken()).id=t,d.ajax({url:d(".visualized-tabs-wrapper").attr("data-getProductsForSourceTypeUrl"),type:"POST",data:e}).done(function(t){a.find(".found-products-grid .products-grid").html(t),"70"!==a.find("select.itemSourceType").val()&&!a.find("input.category-custom-collection").is(":checked")||d(".visualized-tabs-wrapper").trigger("customListProductsLoaded",{tabContent:a})}).always(function(){a.find(".found-products-grid .loader").hide(),d(".products-vary-by-acl-message").removeClass("hidden")})}function u(t){var a=d(".visualized-tabs-wrapper"),i=t.closest(".tab-content.k-content"),n=parseInt(t.val()),t=addAntiForgeryToken(),o=parseInt(i.find(".group-item-id").val())||0,r=d('#tabstrip .tabs-anchors li[aria-controls="'+i.attr("id")+'"]');t.itemId=o,t.sourceType=n,i.find(".custom-item-content, .found-products-grid .products-grid, .custom-list-add-products").empty(),0!==n?d.ajax({url:a.attr("data-sourceTypeChangeUrl"),type:"POST",data:t}).done(function(t){var e=i.find(".custom-item-content");e.html(t),i.find(".custom-list-add-products").empty();e=e.find('.group-item-title[name="Title"]').val();e&&r.find(".k-link").text(e),10!==n&&20!==n&&30!==n&&35!==n&&70!==n||l(o),a.on("change",".itemEntityId, .itemSortMethod",function(){p(d(this))})}):(t=a.attr("data-defaultItemTitle")||"<No Title>",r.find(".k-link").text(t))}function a(t){var e=t.closest(".tab-content.k-content"),a=t.closest("form"),i=a.attr("action"),t=a.attr("method"),n=parseInt(e.find(".group-item-id").val())||0;isNaN(n)||0===n||(e=a.serialize(),e+="&save=save",d.ajax({url:i,type:t,data:e}).done(function(){a.find(".homepage-products-mappings-grid").DataTable().ajax.reload(),l(n)}))}function o(){var t,o=d(".visualized-tabs-wrapper");0!==(t=d("#tabstrip")).length&&(0<(r=t.kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:c}).data("kendoTabStrip")).tabGroup.children().length&&r.activateTab("li:first"),d("#tabstrip ul.k-tabstrip-items").kendoSortable({filter:"li.k-item:not(#add-new-item-from-tabstrip-button)",axis:"x",container:"ul.k-tabstrip-items",hint:function(t){return d("<div id='sortable-tabs-hint' class='k-widget k-header k-tabstrip'><ul class='k-tabstrip-items k-reset'><li class='k-item k-state-active k-tab-on-top'>"+t.html()+"</li></ul></div>")},start:function(t){r.activateTab(t.item)},change:function(t){var e=r.tabGroup.children().eq(t.newIndex);t.oldIndex<t.newIndex?r.insertAfter(t.item,e):r.insertBefore(t.item,e),i.push(function(){var t=[];d("#tabstrip li.k-item["+s+"]").each(function(){t.push(d(this).attr(s))});var e=d(".categories-sortable-list .sortable.active"),a=addAntiForgeryToken();a.groupId=parseInt(d("#Id").val())||parseInt(e.attr("data-productgroupid"))||0,a.ids=t,i.isSaveToPop(!1),d.ajax({url:d(".visualized-tabs-wrapper").attr("data-reorderGroupItemsUrl"),type:"POST",data:a}).fail(function(t){}).always(function(){i.isSaveToPop(!0)})})}})),d(".add-new-group-item-button, #add-new-item-from-tabstrip-button").off("click"),o.off("change",".itemSourceType"),o.off("click",".remove-item"),o.off("change",".group-item-title"),o.off("change",".group-item-active-input"),o.off("change",".itemEntityId, .itemSortMethod"),o.off("click",'.custom-list-add-products .homepage-products-mappings-grid input[type="checkbox"]'),o.off("click",".found-products-grid .item-box .remove-button"),o.off("customListProductsLoaded"),d("#Store").off("change"),d(".add-new-group-item-button, #add-new-item-from-tabstrip-button").on("click",function(t){t.preventDefault(),r.disable(d("#add-new-item-from-tabstrip-button"));var e=d(".categories-sortable-list .sortable.active"),t=addAntiForgeryToken();t.groupId=parseInt(d("#Id").val())||parseInt(e.attr("data-productgroupid"))||0,t.categoryId=parseInt(e.attr("data-categoryid"))||0,d.ajax({url:o.attr("data-createGroupItemUrl"),type:"POST",data:t}).done(function(t){var e,a=d(t),i=a.find(".group-item-id"),n=i.val();null!=n&&(d(".add-new-group-item-button").addClass("hidden"),d(".no-product-items-available").addClass("hidden"),e=d("#add-new-item-from-tabstrip-button"),t=d(".add-new-item-tabstrip-content"),d("#tabstrip").show().find(t).before(a),r.insertBefore({text:i.attr("data-defaultTitle")},e),(e=e.prev()).attr(s,n),r.activateTab(e),2<r.tabGroup.children().length&&d(".drag-and-drop-items-info").removeClass("hidden"),c(),o.on("change",".itemEntityId, .itemSortMethod",function(){p(d(this))}),o.on("change",".itemSourceType",function(){u(d(this))}),r.enable(d("#add-new-item-from-tabstrip-button")))})}),o.on("click",".remove-item",function(t){t.preventDefault();var t=d(this),e=parseInt(t.attr(s));isNaN(e)||0===e||!1!==confirm("Are you sure ?")&&((t=addAntiForgeryToken()).id=e,d.ajax({url:o.attr("data-deleteGroupItemUrl"),type:"POST",data:t}).done(function(){var t=d("#tabstrip li").filter("["+s+'="'+e+'"]');r.remove(t),1===r.tabGroup.children().length?(d("#tabstrip").hide(),d(".add-new-group-item-button").removeClass("hidden"),d(".no-product-items-available").removeClass("hidden"),d(".products-vary-by-acl-message").addClass("hidden")):t.is(".k-state-active")&&r.activateTab("li:first"),r.tabGroup.children().length<=2&&d(".drag-and-drop-items-info").addClass("hidden")}))}),o.on("change",".group-item-title",function(){var t=d(this),e=t.val(),t=t.closest(".tab-content.k-content"),a=d('#tabstrip .tabs-anchors li[aria-controls="'+t.attr("id")+'"]'),i=t.find(".group-item-title"),t=t.find('input[name$="LanguageId"]'),n=addAntiForgeryToken();n.Id=parseInt(a.attr(s))||0,n.Title=i.filter('[name="Title"]').val(),i.each(function(){var t=d(this);n[t.attr("name")]=t.val()}),t.each(function(){var t=d(this);n[t.attr("name")]=t.val()}),""!==e&&a.find(".k-link").text(e),d.ajax({url:o.attr("data-titleChangeUrl"),type:"POST",data:n}).done(function(t){i.filter('[name="Title"]').val(t.title),a.find(".k-link").text(t.title)})}),o.on("change",".group-item-active-input",function(){var t=d(this),e=addAntiForgeryToken();e.Id=parseInt(t.attr(s))||0,e.Active=t.is(":checked"),d.ajax({url:o.attr("data-activeChangeUrl"),type:"POST",data:e})}),o.on("change",".category-custom-collection",function(){var e=d(this),t=addAntiForgeryToken(),a=parseInt(e.attr(s));t.Id=a||0,t.EnableCategoryCustomCollection=e.is(":checked");var i=e.closest(".tab-content.k-content");d.ajax({url:o.attr("data-enablecategorycustomcollectionurl"),type:"POST",data:t}).done(function(t){i.find(".custom-item-content").html(t),i.find(".custom-list-add-products").empty(),o.on("change",".itemEntityId, .itemSortMethod",function(){p(d(this))}),e.is(":checked")&&d.event.trigger({type:"initializeCustomCategoryMappingPanel"}),l(a)})}),o.on("change",".itemEntityId, .itemSortMethod",function(){p(d(this))}),o.on("change",".itemSourceType",function(){u(d(this))}),o.on("click",'.custom-list-add-products [id^="products-grid-"] input[type="checkbox"]',function(){var t=d(this);t.is(":checked")?a(t):(t=t).closest(".tab-content.k-content").find('.found-products-grid .item-box[data-productId="'+t.val()+'"] .remove-button').click()}),o.on("click",".found-products-grid .item-box .remove-button",function(){var t=d(this),e=t.closest(".tab-content.k-content"),a=parseInt(e.find(".group-item-id").val())||0,i=t.closest(".item-box"),n=parseInt(i.attr("data-productId"))||0;isNaN(a)||0===a||isNaN(n)||0===n||((t=addAntiForgeryToken()).id=a,t.productId=n,d.ajax({url:o.attr("data-deleteProductFromCustomListUrl"),type:"POST",data:t}).done(function(){i.remove(),e.find(".homepage-products-mappings-grid").DataTable().ajax.reload(),l(a)}))}),o.on("customListProductsLoaded",function(t,e){var a,i=e.tabContent;null!=i&&0!==i.length&&("70"!==i.find("select.itemSourceType").val()&&!i.find("input.category-custom-collection").is(":checked")||((a=i.find(".found-products-grid .products-grid")).hasClass("sortable-grid")&&a.kendoSortable("destroy"),a.addClass("sortable-grid"),(e=a.children(".item-box")).addClass("sortable removable"),e.prepend('<div class="remove-button">remove</div>'),i.find(".drag-and-drop-products-info").toggleClass("hidden",e.length<2),a.kendoSortable({filter:".item-box.sortable",container:a,hint:function(t){return t.clone().addClass("hint")},placeholder:function(){return'<div class="item-box sortable placeholder"><span>Drag and drop your product here</span></div>'},change:function(){n.push(function(){var t=[];i.find(".products-grid.sortable-grid .item-box.sortable").each(function(){t.push(d(this).attr("data-productId"))});var e=addAntiForgeryToken();e.itemId=parseInt(i.find(".group-item-id").val())||0,e.productIds=t,n.isSaveToPop(!1),d.ajax({url:o.attr("data-reorderProductsInCustomListUrl"),type:"POST",data:e}).fail(function(){}).always(function(){n.isSaveToPop(!0)})})}})))}),d("#Store").on("change",function(){var e=d(this).val();d(".searchStoreId").each(function(){var t=d(this);t.val(e),a(t)})}),d(".products-vary-by-acl-message").each(function(){var t=d(this);0<t.closest(".tab-content").find(".products-grid .item-box").length&&t.removeClass("hidden")})}var p=function(t){var a=d(".visualized-tabs-wrapper"),i=t.closest(".tab-content.k-content"),n=d('#tabstrip .tabs-anchors li[aria-controls="'+i.attr("id")+'"]'),o=parseInt(i.find(".group-item-id").val())||0,e=parseInt(i.find("select.itemEntityId").val())||0,r=parseInt(i.find("select.itemSortMethod").val())||0;0!==e?((t=addAntiForgeryToken()).Id=o,t.EntityId=e,t.SortMethod=r,d.ajax({url:a.attr("data-entityOrSortMethodChangeUrl"),type:"POST",data:t}).done(function(t){var e=t.title||a.attr("data-defaultItemTitle")||"<No Title>";n.find(".k-link").text(e),t.title&&i.find('[name="Title"]').val(t.title),l(o)})):i.find(".found-products-grid .products-grid").empty()};d(document).ready(function(){var t,e;o(),d(document).on("newProductGroupAddedEvent",o),t=d("#NumberOfProductsPerItem"),e=d("#NumberOfProducts"),e=t.length?t:e,e=parseInt(e.val())+1,d("head").append("<style> .products-grid .sortable:nth-child(n+"+e+") { opacity: 0.2; } </style>")})}(jQuery);