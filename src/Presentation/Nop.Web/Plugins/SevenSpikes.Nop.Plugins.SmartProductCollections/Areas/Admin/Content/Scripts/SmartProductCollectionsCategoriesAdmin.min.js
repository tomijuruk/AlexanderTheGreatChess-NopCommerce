!function(o){function a(a){var r=o(".category-tabs-editor-wrapper"),e=r.children(".category-tabs-editor");e.empty(),r.show().children(".loader").show(),o.ajax({url:o(".category-autocomplete-wrapper").attr("data-getProductsGroupTabsUrl"),type:"POST",data:function(t){t={groupId:t};return t=addAntiForgeryToken(t)}(a)}).done(function(t){e.html(t),o.event.trigger({type:"newProductGroupAddedEvent"}),o.event.trigger({type:"initializeCustomCategoryMappingPanel"})}).always(function(){var t,e=o('.sortable[data-productGroupId="'+a+'"]').children("span:first").text();t=e,0===(e=o(".tab-builder-title")).children(".tab-category-title").length&&e.append('<span class="tab-category-title"></span>'),e.children(".tab-category-title").text(" ("+t+")"),r.children(".loader").fadeOut()})}function i(){var t=0,e=o("#store-scope-configuration");return 0<e.length&&(null!=(e=e.val().split("?")[1])&&(null==(e=e.split("&")[0])||void 0!==(e=e.split("="))[1]&&"storeid"===e[0].toLowerCase()&&(t=parseInt(e[1])))),t}function r(){var t,r="";o(".categories-sortable-list span.sortable[data-categoryid]").each(function(){var t=o(this),e=parseInt(t.attr("data-categoryid"))||0,a=parseInt(t.attr("data-productGroupId"))||0;r+=e+":"+a,0<t.next("span.sortable[data-categoryid]").length&&(r+=",")}),o("#CategoryGroupIds").val(r),t={categoryGroupIds:o("#CategoryGroupIds").val(),storeId:i()},t=addAntiForgeryToken(t),o.ajax({url:o(".category-autocomplete-wrapper").attr("data-saveCategoryGroupIdsSettingUrl"),type:"POST",data:t})}function e(t){var t=o(t),e=parseInt(t.attr("data-categoryId"))||0;0<o('.categories-sortable-list span[data-categoryId="'+e+'"]').length||(t.addClass("sortable"),t.append('<span class="edit-item-button" title="Edit"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>'),t.append('<span class="remove-category-item remove-item-button" title="Remove"><i class="fa fa-times" aria-hidden="true"></i></span>'),o.ajax({url:o(".category-autocomplete-wrapper").attr("data-createProductsGroupUrl"),type:"POST",data:function(t){t={categoryId:t,storeId:i()};return t=addAntiForgeryToken(t)}(e)}).done(function(t){o('.categories-sortable-list span[data-categoryId="'+e+'"]').attr("data-productGroupId",t.toString()),o('.categories-sortable-list span[data-productgroupid="'+t+'"] .edit-item-button').click()}).always(function(){r()}),o(".categories-sortable-list").append(t))}function t(){var t={categoryName:o("#choose-category-autocomplete").val()||""};return t=addAntiForgeryToken(t)}function s(t,e){0!==o("#"+t).length&&(o("#"+t).is(":checked")?o(".overlay-for-"+t).remove():o(e).append('<div class="custom-fields-overlay overlay-for-'+t+'"></div>'))}function n(t,e){var a=o(e);"static"===a.css("position")&&a.css("position","relative"),o("#"+t).change(function(){s(t,e)}),s(t,e)}o(document).ready(function(){o("#choose-category-autocomplete").kendoAutoComplete({dataTextField:"name",filter:"contains",highlightFirst:!0,dataSource:{serverFiltering:!0,transport:{read:{url:o(".category-autocomplete-wrapper").attr("data-getCategoriesUrl"),dataType:"json",data:t}}},template:kendo.template(o("#categoriesSortingTemplate").html()),change:function(){var t=o("#choose-category-autocomplete_listbox .k-state-selected").html();this.value(""),e(t),r()}}),o(".categories-sortable-list").kendoSortable({filter:"span.sortable",container:o(".categories-sortable-list"),hint:function(t){return o('<div class="sortable-categories-drag-drop-hint">'+t.html()+"</div>")},change:r}),o(".categories-sortable-list").on("click",".remove-category-item",function(){var t=o(this).closest(".sortable[data-categoryid]");t.is(".active")&&o(".category-tabs-editor-wrapper").hide(),t.remove(),r()}),o(".categories-sortable-list").on("click",".edit-item-button",function(){var t=o(this).closest(".sortable[data-categoryid]"),e=t.attr("data-productGroupId");t.addClass("active").siblings(".sortable").removeClass("active"),a(e)}),o(".store-scope-configuration .checkbox input").change(function(){n("CategoryGroupIds_OverrideForStore",".choosed-categories-holder")}),n("CategoryGroupIds_OverrideForStore",".choosed-categories-holder")})}(jQuery);